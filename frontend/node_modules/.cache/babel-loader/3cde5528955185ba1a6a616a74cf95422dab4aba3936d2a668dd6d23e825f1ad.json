{"ast":null,"code":"var _s = $RefreshSig$();\n// frontend/src/hooks/useGeolocation.js\nimport { useState, useEffect, useRef, useCallback } from 'react';\nconst useGeolocation = () => {\n  _s();\n  const [location, setLocation] = useState({\n    loaded: false,\n    coordinates: {\n      lat: null,\n      lng: null\n    },\n    error: null\n  });\n  const lastPosition = useRef(null); // ðŸ§­ LÆ°u vá»‹ trÃ­ gáº§n nháº¥t Ä‘á»ƒ so sÃ¡nh\n\n  // ðŸ‘‰ HÃ m tÃ­nh khoáº£ng cÃ¡ch giá»¯a 2 tá»a Ä‘á»™ (km)\n  const getDistance = useCallback((lat1, lon1, lat2, lon2) => {\n    const R = 6371; // km\n    const dLat = (lat2 - lat1) * Math.PI / 180;\n    const dLon = (lon2 - lon1) * Math.PI / 180;\n    const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon / 2) * Math.sin(dLon / 2);\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n    return R * c;\n  }, []);\n\n  // âœ… Xá»­ lÃ½ khi láº¥y Ä‘Æ°á»£c vá»‹ trÃ­ thÃ nh cÃ´ng\n  const onSuccess = useCallback(position => {\n    console.log('âœ… Vá»‹ trÃ­ nháº­n Ä‘Æ°á»£c:', position);\n    const {\n      latitude,\n      longitude\n    } = position.coords;\n    if (!lastPosition.current || getDistance(lastPosition.current.latitude, lastPosition.current.longitude, latitude, longitude) > 0.02 // chá»‰ cáº­p nháº­t náº¿u di chuyá»ƒn > 20m\n    ) {\n      lastPosition.current = {\n        latitude,\n        longitude\n      };\n      setLocation({\n        loaded: true,\n        coordinates: {\n          lat: latitude,\n          lng: longitude\n        },\n        error: null\n      });\n    }\n  }, [getDistance]);\n\n  // âŒ Xá»­ lÃ½ khi lá»—i vá»‹ trÃ­\n  const onError = useCallback(error => {\n    console.error('âŒ Lá»—i geolocation:', error);\n    setLocation({\n      loaded: true,\n      coordinates: {\n        lat: null,\n        lng: null\n      },\n      error: error.message || 'KhÃ´ng thá»ƒ láº¥y vá»‹ trÃ­ ngÆ°á»i dÃ¹ng.'\n    });\n  }, []);\n\n  // ðŸŽ¯ Láº¯ng nghe vá»‹ trÃ­ ngÆ°á»i dÃ¹ng liÃªn tá»¥c\n  useEffect(() => {\n    if (!('geolocation' in navigator)) {\n      onError({\n        message: 'TrÃ¬nh duyá»‡t khÃ´ng há»— trá»£ Ä‘á»‹nh vá»‹.'\n      });\n      return;\n    }\n    const watchId = navigator.geolocation.watchPosition(onSuccess, onError, {\n      enableHighAccuracy: true,\n      timeout: 15000,\n      maximumAge: 10000\n    });\n\n    // Cleanup khi component unmount\n    return () => navigator.geolocation.clearWatch(watchId);\n  }, [onSuccess, onError]);\n  return location;\n};\n_s(useGeolocation, \"zjMUgZkWA6R6amD0p8y8cgKt+VU=\");\nexport default useGeolocation;","map":{"version":3,"names":["useState","useEffect","useRef","useCallback","useGeolocation","_s","location","setLocation","loaded","coordinates","lat","lng","error","lastPosition","getDistance","lat1","lon1","lat2","lon2","R","dLat","Math","PI","dLon","a","sin","cos","c","atan2","sqrt","onSuccess","position","console","log","latitude","longitude","coords","current","onError","message","navigator","watchId","geolocation","watchPosition","enableHighAccuracy","timeout","maximumAge","clearWatch"],"sources":["E:/IT4409/frontend/src/hooks/useGeolocation.js"],"sourcesContent":["// frontend/src/hooks/useGeolocation.js\r\nimport { useState, useEffect, useRef, useCallback } from 'react';\r\n\r\nconst useGeolocation = () => {\r\n  const [location, setLocation] = useState({\r\n    loaded: false,\r\n    coordinates: { lat: null, lng: null },\r\n    error: null,\r\n  });\r\n\r\n  const lastPosition = useRef(null); // ðŸ§­ LÆ°u vá»‹ trÃ­ gáº§n nháº¥t Ä‘á»ƒ so sÃ¡nh\r\n\r\n  // ðŸ‘‰ HÃ m tÃ­nh khoáº£ng cÃ¡ch giá»¯a 2 tá»a Ä‘á»™ (km)\r\n  const getDistance = useCallback((lat1, lon1, lat2, lon2) => {\r\n    const R = 6371; // km\r\n    const dLat = ((lat2 - lat1) * Math.PI) / 180;\r\n    const dLon = ((lon2 - lon1) * Math.PI) / 180;\r\n    const a =\r\n      Math.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n      Math.cos((lat1 * Math.PI) / 180) *\r\n        Math.cos((lat2 * Math.PI) / 180) *\r\n        Math.sin(dLon / 2) *\r\n        Math.sin(dLon / 2);\r\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n    return R * c;\r\n  }, []);\r\n\r\n  // âœ… Xá»­ lÃ½ khi láº¥y Ä‘Æ°á»£c vá»‹ trÃ­ thÃ nh cÃ´ng\r\n  const onSuccess = useCallback(\r\n    (position) => {\r\n      console.log('âœ… Vá»‹ trÃ­ nháº­n Ä‘Æ°á»£c:', position);\r\n      const { latitude, longitude } = position.coords;\r\n\r\n      if (\r\n        !lastPosition.current ||\r\n        getDistance(\r\n          lastPosition.current.latitude,\r\n          lastPosition.current.longitude,\r\n          latitude,\r\n          longitude\r\n        ) > 0.02 // chá»‰ cáº­p nháº­t náº¿u di chuyá»ƒn > 20m\r\n      ) {\r\n        lastPosition.current = { latitude, longitude };\r\n        setLocation({\r\n          loaded: true,\r\n          coordinates: { lat: latitude, lng: longitude },\r\n          error: null,\r\n        });\r\n      }\r\n    },\r\n    [getDistance]\r\n  );\r\n\r\n  // âŒ Xá»­ lÃ½ khi lá»—i vá»‹ trÃ­\r\n  const onError = useCallback((error) => {\r\n    console.error('âŒ Lá»—i geolocation:', error);\r\n    setLocation({\r\n      loaded: true,\r\n      coordinates: { lat: null, lng: null },\r\n      error: error.message || 'KhÃ´ng thá»ƒ láº¥y vá»‹ trÃ­ ngÆ°á»i dÃ¹ng.',\r\n    });\r\n  }, []);\r\n\r\n  // ðŸŽ¯ Láº¯ng nghe vá»‹ trÃ­ ngÆ°á»i dÃ¹ng liÃªn tá»¥c\r\n  useEffect(() => {\r\n    if (!('geolocation' in navigator)) {\r\n      onError({ message: 'TrÃ¬nh duyá»‡t khÃ´ng há»— trá»£ Ä‘á»‹nh vá»‹.' });\r\n      return;\r\n    }\r\n\r\n    const watchId = navigator.geolocation.watchPosition(onSuccess, onError, {\r\n      enableHighAccuracy: true,\r\n      timeout: 15000,\r\n      maximumAge: 10000,\r\n    });\r\n\r\n    // Cleanup khi component unmount\r\n    return () => navigator.geolocation.clearWatch(watchId);\r\n  }, [onSuccess, onError]);\r\n\r\n  return location;\r\n};\r\n\r\nexport default useGeolocation;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}