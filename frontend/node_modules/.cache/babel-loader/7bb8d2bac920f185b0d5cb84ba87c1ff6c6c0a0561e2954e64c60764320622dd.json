{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect, useRef } from 'react';\nconst useGeolocation = () => {\n  _s();\n  const [location, setLocation] = useState({\n    loaded: false,\n    coordinates: {\n      lat: null,\n      lng: null\n    },\n    error: null\n  });\n  const lastPosition = useRef(null); // üß≠ L∆∞u v·ªã tr√≠ g·∫ßn nh·∫•t ƒë·ªÉ so s√°nh\n\n  const onSuccess = position => {\n    const {\n      latitude,\n      longitude,\n      accuracy\n    } = position.coords;\n\n    // N·∫øu v·ªã tr√≠ m·ªõi kh√°c bi·ªát ƒë√°ng k·ªÉ so v·ªõi v·ªã tr√≠ c≈© th√¨ m·ªõi c·∫≠p nh·∫≠t\n    if (!lastPosition.current || getDistance(lastPosition.current.latitude, lastPosition.current.longitude, latitude, longitude) > 0.02 // ch·ªâ c·∫≠p nh·∫≠t n·∫øu di chuy·ªÉn > 20m\n    ) {\n      lastPosition.current = {\n        latitude,\n        longitude\n      };\n      setLocation({\n        loaded: true,\n        coordinates: {\n          lat: latitude,\n          lng: longitude\n        },\n        error: null\n      });\n    }\n  };\n  const onError = error => {\n    setLocation({\n      loaded: true,\n      coordinates: {\n        lat: null,\n        lng: null\n      },\n      error: error.message || 'Kh√¥ng th·ªÉ l·∫•y v·ªã tr√≠ ng∆∞·ªùi d√πng.'\n    });\n  };\n  useEffect(() => {\n    if (!('geolocation' in navigator)) {\n      onError({\n        message: 'Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ ƒë·ªãnh v·ªã.'\n      });\n      return;\n    }\n\n    // S·ª≠ d·ª•ng watchPosition ƒë·ªÉ theo d√µi v·ªã tr√≠ li√™n t·ª•c\n    const watchId = navigator.geolocation.watchPosition(onSuccess, onError, {\n      enableHighAccuracy: true,\n      timeout: 15000,\n      maximumAge: 10000\n    });\n\n    // Cleanup khi component unmount\n    return () => navigator.geolocation.clearWatch(watchId);\n  }, []);\n  return location;\n};\n\n// üëâ H√†m t√≠nh kho·∫£ng c√°ch gi·ªØa 2 t·ªça ƒë·ªô (km)\n_s(useGeolocation, \"rsVNLwJjsmgW4n8w1sZrtJ2wFfE=\");\nfunction getDistance(lat1, lon1, lat2, lon2) {\n  const R = 6371; // km\n  const dLat = (lat2 - lat1) * Math.PI / 180;\n  const dLon = (lon2 - lon1) * Math.PI / 180;\n  const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon / 2) * Math.sin(dLon / 2);\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n  return R * c;\n}\nexport default useGeolocation;","map":{"version":3,"names":["useState","useEffect","useRef","useGeolocation","_s","location","setLocation","loaded","coordinates","lat","lng","error","lastPosition","onSuccess","position","latitude","longitude","accuracy","coords","current","getDistance","onError","message","navigator","watchId","geolocation","watchPosition","enableHighAccuracy","timeout","maximumAge","clearWatch","lat1","lon1","lat2","lon2","R","dLat","Math","PI","dLon","a","sin","cos","c","atan2","sqrt"],"sources":["G:/IT4409/frontend/src/hooks/useGeolocation.js"],"sourcesContent":["import { useState, useEffect, useRef } from 'react';\r\n\r\nconst useGeolocation = () => {\r\n  const [location, setLocation] = useState({\r\n    loaded: false,\r\n    coordinates: { lat: null, lng: null },\r\n    error: null,\r\n  });\r\n\r\n  const lastPosition = useRef(null); // üß≠ L∆∞u v·ªã tr√≠ g·∫ßn nh·∫•t ƒë·ªÉ so s√°nh\r\n\r\n  const onSuccess = (position) => {\r\n    const { latitude, longitude, accuracy } = position.coords;\r\n\r\n    // N·∫øu v·ªã tr√≠ m·ªõi kh√°c bi·ªát ƒë√°ng k·ªÉ so v·ªõi v·ªã tr√≠ c≈© th√¨ m·ªõi c·∫≠p nh·∫≠t\r\n    if (\r\n      !lastPosition.current ||\r\n      getDistance(\r\n        lastPosition.current.latitude,\r\n        lastPosition.current.longitude,\r\n        latitude,\r\n        longitude\r\n      ) > 0.02 // ch·ªâ c·∫≠p nh·∫≠t n·∫øu di chuy·ªÉn > 20m\r\n    ) {\r\n      lastPosition.current = { latitude, longitude };\r\n      setLocation({\r\n        loaded: true,\r\n        coordinates: { lat: latitude, lng: longitude },\r\n        error: null,\r\n      });\r\n    }\r\n  };\r\n\r\n  const onError = (error) => {\r\n    setLocation({\r\n      loaded: true,\r\n      coordinates: { lat: null, lng: null },\r\n      error: error.message || 'Kh√¥ng th·ªÉ l·∫•y v·ªã tr√≠ ng∆∞·ªùi d√πng.',\r\n    });\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!('geolocation' in navigator)) {\r\n      onError({ message: 'Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ ƒë·ªãnh v·ªã.' });\r\n      return;\r\n    }\r\n\r\n    // S·ª≠ d·ª•ng watchPosition ƒë·ªÉ theo d√µi v·ªã tr√≠ li√™n t·ª•c\r\n    const watchId = navigator.geolocation.watchPosition(onSuccess, onError, {\r\n      enableHighAccuracy: true,\r\n      timeout: 15000,\r\n      maximumAge: 10000,\r\n    });\r\n\r\n    // Cleanup khi component unmount\r\n    return () => navigator.geolocation.clearWatch(watchId);\r\n  }, []);\r\n\r\n  return location;\r\n};\r\n\r\n// üëâ H√†m t√≠nh kho·∫£ng c√°ch gi·ªØa 2 t·ªça ƒë·ªô (km)\r\nfunction getDistance(lat1, lon1, lat2, lon2) {\r\n  const R = 6371; // km\r\n  const dLat = ((lat2 - lat1) * Math.PI) / 180;\r\n  const dLon = ((lon2 - lon1) * Math.PI) / 180;\r\n  const a =\r\n    Math.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n    Math.cos((lat1 * Math.PI) / 180) *\r\n      Math.cos((lat2 * Math.PI) / 180) *\r\n      Math.sin(dLon / 2) *\r\n      Math.sin(dLon / 2);\r\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n  return R * c;\r\n}\r\n\r\nexport default useGeolocation;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}